var DOM_LOADED="DOM_LOADED";var DOM_UNLOADED="DOM_UNLOADED";var MESH_INTERCEPT="MESH_INTERCEPT";self.version=1.2;self.supportedExtensions=["jpg","jpeg","gif","png","bmp","svg","webp"];var state={};var dataURItoBlob=function(dataURI){var byteString=atob(dataURI.split(",")[1]);var mimeString=dataURI.split(",")[0].split(":")[1].split(";")[0];var ab=new ArrayBuffer(byteString.length);var ia=new Uint8Array(ab);for(var i=0;i<byteString.length;i++){ia[i]=byteString.charCodeAt(i)}return new Blob([ab],{type:mimeString})};var onePixel="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAABBJREFUeNpi+P//PwNAgAEACPwC/tuiTRYAAAAASUVORK5CYII=";var respondMesh=function(clientId,assets){self.clients.get(clientId).then(function(client){client.postMessage({channel:MESH_INTERCEPT,value:{assets:assets}})})};var respondBlank=function(event){event.respondWith(new Response(dataURItoBlob(onePixel)))};var checkState=function(client,originId,assetId,url){if(state.domLoaded){var asset={};asset[url]=originId+"|"+assetId;respondMesh(client,asset)}else{if(!state.pendingAssets){state.pendingAssets={}}if(!state.pendingAssets[client]){state.pendingAssets[client]=[]}state.pendingAssets[client].push({key:originId+"|"+assetId,url:url})}};var hash=function(key){var hash=0;if(key.length===0){return hash}for(var i=0;i<key.length;i++){var char=key.charCodeAt(i);hash=(hash<<5)-hash+char;hash&=hash}return hash};var getLocation=function(href){var match=href.match(/^(https?:)\/\/(([^:\/?#]*)(?::([0-9]+))?)(\/[^?#]*)(\?[^#]*|)(#.*|)$/);return match&&{protocol:match[1],host:match[2],hostname:match[3],port:match[4],pathname:match[5],search:match[6],hash:match[7]}};self.addEventListener("install",function(event){state.domLoaded=false;state.fetchActive=false;state.pendingAssets={};event.waitUntil(self.skipWaiting())});self.addEventListener("activate",function(event){state.domLoaded=false;state.fetchActive=false;state.pendingAssets={};event.waitUntil(self.clients.claim())});self.addEventListener("message",function(event){switch(event.data.channel){case DOM_LOADED:{state.domLoaded=true;var clientId=event.source.id;var pendingAssets=state.pendingAssets&&state.pendingAssets[clientId]?state.pendingAssets[clientId]:[];var assets={};pendingAssets.forEach(function(obj){assets[obj.url]=obj.key});respondMesh(clientId,assets);if(pendingAssets.length!==0){delete state.pendingAssets[clientId]}break}case DOM_UNLOADED:{state.domLoaded=false;state.fetchActive=false;break}default:}});self.addEventListener("fetch",function(event){var client=event.clientId;var isEdgemesh=event.request.url.indexOf("edgemesh.client.min.js")!==-1;if(isEdgemesh){state.fetchActive=true;state.domLoaded=false}if(state.fetchActive){var url=event.request.url;var urlArray=url.split(".");var fileExtension=urlArray[urlArray.length-1].toLowerCase();if(self.supportedExtensions.indexOf(fileExtension)===-1){event.respondWith(fetch(event.request)).catch(function(){console.log("unable to fetch "+url)})}else{var location=getLocation(url);var originId=hash(location.hostname);var assetId=hash(location.pathname);respondBlank(event);checkState(client,originId,assetId,url)}}});